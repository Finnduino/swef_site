<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Overlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&family=Fira+Code&family=Orbitron:wght@600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: transparent;
            color: white;
            overflow: hidden;
            font-size: 14px;
        }

        /* Main Match HUD */
        .match-hud {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            width: 1200px;
            max-width: 95vw;
        }

        .hud-container {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 20, 30, 0.9));
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .bracket-info {
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            padding: 12px 40px;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
            width: 100%;
            box-sizing: border-box;
        }

        .players-container {
            display: flex;
            align-items: center;
            padding: 20px 24px;
            gap: 32px;
        }

        .player {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            min-width: 300px;
        }

        .player.winning {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        }

        .player-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .player.winning .player-avatar {
            border-color: #22c55e;
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.4);
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        .player-seed {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .score-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            min-width: 240px;
        }

        .current-score {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 8px;
        }

        .score-tracker {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .score-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .score-dot.p1-win {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
        }

        .score-dot.p2-win {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-color: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }

        .score-dot.p1-win::after,
        .score-dot.p2-win::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            opacity: 0.9;
        }

        .score-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        /* Victory Screens */
        .victory-screen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.98), rgba(20, 20, 30, 0.98));
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px 60px;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            z-index: 1000;
            min-width: 500px;
            animation: victorySlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Match Victory Screen - Redesigned */
        .match-victory {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.98), rgba(20, 20, 30, 0.98));
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            min-width: 700px;
            padding: 0;
            overflow: hidden;
        }

        .victory-header {
            background: linear-gradient(90deg, #22c55e, #16a34a);
            padding: 20px 40px;
            text-align: center;
            position: relative;
        }

        .victory-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            pointer-events: none;
        }

        .victory-content {
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .victory-player {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px 24px;
            min-width: 400px;
        }

        .victory-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #22c55e;
            object-fit: cover;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }

        .victory-player-info {
            flex: 1;
            text-align: left;
        }

        .victory-player-name {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .victory-player-seed {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .victory-score-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            color: #22c55e;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .victory-advancement {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        @keyframes victorySlideIn {
            from { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8) rotateX(20deg);
            }
            to { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) rotateX(0deg);
            }
        }

        .victory-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .victory-header .victory-title {
            font-size: 28px;
            font-weight: 800;
            color: #ffffff;
            background: none;
            -webkit-background-clip: initial;
            -webkit-text-fill-color: initial;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
        }

        .victory-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .victory-details {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Welcome Screen */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0f0f23, #1a1a3a, #2d1b69);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            overflow: hidden;
        }

        .welcome-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
            animation: welcomeGlow 6s ease-in-out infinite alternate;
        }

        @keyframes welcomeGlow {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 0.8; transform: scale(1.1); }
        }

        .welcome-content {
            text-align: center;
            z-index: 1;
            animation: welcomeSlideIn 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes welcomeSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(50px) scale(0.9);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }

        .welcome-logo {
            font-size: 80px;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ffffff, #e0e7ff, #c7d2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(255, 255, 255, 0.3);
            animation: welcomePulse 3s ease-in-out infinite;
            letter-spacing: -2px;
        }

        @keyframes welcomePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .welcome-subtitle {
            font-size: 28px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: welcomeGlide 2s ease-out 0.5s both;
        }

        @keyframes welcomeGlide {
            0% { 
                opacity: 0; 
                transform: translateX(-30px);
            }
            100% { 
                opacity: 1; 
                transform: translateX(0);
            }
        }

        .welcome-year {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 24px;
            animation: welcomeShimmer 2s ease-in-out 1s both;
        }

        @keyframes welcomeShimmer {
            0% { 
                opacity: 0; 
                transform: translateY(20px);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .welcome-message {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            animation: welcomeFadeIn 2s ease-out 1.5s both;
        }

        @keyframes welcomeFadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Outro Screen */
        .outro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0f0f23, #1a1a3a, #2d1b69);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            overflow: hidden;
        }

        .outro-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 70%, rgba(34, 197, 94, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 70% 30%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(120, 119, 198, 0.2) 0%, transparent 70%);
            animation: outroGlow 4s ease-in-out infinite alternate;
        }

        @keyframes outroGlow {
            0% { opacity: 0.6; transform: rotate(0deg) scale(1); }
            100% { opacity: 0.9; transform: rotate(1deg) scale(1.05); }
        }

        .outro-content {
            text-align: center;
            z-index: 1;
            animation: outroSlideIn 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes outroSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(-50px) scale(0.9);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }

        .outro-title {
            font-size: 72px;
            font-weight: 900;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
            animation: outroSparkle 3s ease-in-out infinite;
            letter-spacing: -1px;
        }

        @keyframes outroSparkle {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
            }
            50% { 
                transform: scale(1.02);
                text-shadow: 0 0 60px rgba(255, 215, 0, 0.5);
            }
        }

        .outro-subtitle {
            font-size: 32px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: outroFadeIn 1.5s ease-out 0.5s both;
        }

        @keyframes outroFadeIn {
            0% { 
                opacity: 0; 
                transform: translateY(20px);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .outro-message {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            margin-bottom: 16px;
            animation: outroSlideUp 2s ease-out 1s both;
        }

        .outro-thanks {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
            animation: outroSlideUp 2s ease-out 1.5s both;
        }

        @keyframes outroSlideUp {
            0% { 
                opacity: 0; 
                transform: translateY(30px);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        /* Confetti Effect for Outro */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fbbf24;
            animation: confettiFall 3s linear infinite;
        }

        .confetti:nth-child(odd) {
            background: #22c55e;
            border-radius: 50%;
        }

        .confetti:nth-child(even) {
            background: #3b82f6;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* AFK Screen */
        .afk-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1e1b4b, #312e81, #1e40af);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        /* Match Interface Overlay */
        .match-interface-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(10, 10, 20, 0.95), rgba(20, 20, 40, 0.95));
            backdrop-filter: blur(10px);
            z-index: 1500;
            padding: 20px;
            overflow-y: auto;
        }

        .interface-container {
            max-width: 1800px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .interface-header {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(20, 20, 30, 0.8));
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .phase-indicator {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .phase-indicator.pick-phase {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }

        .phase-indicator.play-phase {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .phase-indicator.play-starting {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            animation: pulse 2s infinite;
        }

        .turn-indicator {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            font-size: 14px;
        }

        .mappool-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .mappool-grid {
            display: grid;
            grid-template-columns: 1fr 400px 1fr;
            gap: 20px;
            height: 100%;
        }

        .player-mappool {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .mappool-header {
            color: white;
            font-weight: 700;
            font-size: 18px;
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .maps-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .overlay-map-card {
            background: linear-gradient(135deg, rgba(45, 55, 72, 0.8), rgba(26, 32, 44, 0.8));
            border: 2px solid rgba(74, 85, 104, 0.6);
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s ease;
            position: relative;
            min-height: 80px;
        }

        .overlay-map-card.banned {
            background: linear-gradient(135deg, rgba(127, 29, 29, 0.8), rgba(153, 27, 27, 0.8));
            border-color: rgba(239, 68, 68, 0.6);
            opacity: 0.6;
        }

        .overlay-map-card.banned::after {
            content: "🚫";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            z-index: 1;
        }

        .overlay-map-card.picked {
            background: linear-gradient(135deg, rgba(6, 95, 70, 0.8), rgba(4, 120, 87, 0.8));
            border-color: rgba(16, 185, 129, 0.6);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .overlay-map-card.picked::after {
            content: "✓";
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .map-title {
            color: white;
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .map-difficulty {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            margin-bottom: 6px;
        }

        .map-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .map-star {
            color: #fbbf24;
            font-weight: bold;
        }

        .action-feed-section {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            max-height: 100%;
        }

        .action-feed-header {
            color: white;
            font-weight: 700;
            font-size: 16px;
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .action-feed {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            max-height: 200px;
        }

        .action-item {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid transparent;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
        }

        .action-item.ban {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .action-item.pick {
            border-left-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .action-item.ability {
            border-left-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }

        .action-item.system {
            border-left-color: #6b7280;
            background: rgba(107, 114, 128, 0.1);
        }

        .picked-maps-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .picked-maps-header {
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .picked-maps-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .picked-map-item {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 8px 10px;
            color: white;
            font-size: 12px;
        }

        .picked-map-round {
            color: rgba(34, 197, 94, 0.8);
            font-weight: bold;
            margin-bottom: 2px;
        }

        .picked-map-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .picked-map-picker {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
        }

        .brb-content {
            text-align: center;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .brb-title {
            font-size: 64px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ffffff, #e5e7eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .tournament-title {
            font-size: 24px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .next-match {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        /* Animations and Effects */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .slide-up {
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive adjustments */
        @media (max-width: 1280px) {
            .match-hud {
                width: 95vw;
                top: 20px;
            }
            
            .current-score {
                font-size: 24px;
            }
            
            .player-name {
                font-size: 16px;
            }
            
            .victory-screen {
                min-width: 450px;
                padding: 40px 50px;
            }
            
            .match-victory {
                min-width: 600px;
            }
            
            .victory-player {
                min-width: 350px;
            }
            
            .victory-avatar {
                width: 70px;
                height: 70px;
            }
            
            .victory-player-name {
                font-size: 20px;
            }
            
            .victory-score-display {
                font-size: 28px;
            }

            .welcome-logo {
                font-size: 60px;
            }

            .welcome-subtitle {
                font-size: 24px;
            }

            .welcome-year {
                font-size: 36px;
            }

            .outro-title {
                font-size: 56px;
            }

            .outro-subtitle {
                font-size: 28px;
            }
        }

        @media (max-width: 768px) {
            .match-hud {
                width: 98vw;
                top: 15px;
            }
            
            .players-container {
                padding: 16px 20px;
                gap: 24px;
            }
            
            .player {
                min-width: 200px;
                padding: 12px 16px;
            }
            
            .score-section {
                min-width: 180px;
            }
            
            .current-score {
                font-size: 20px;
            }
            
            .player-name {
                font-size: 14px;
            }
            
            .player-avatar {
                width: 40px;
                height: 40px;
            }
            
            .victory-screen {
                min-width: 90vw;
                padding: 30px 20px;
            }
            
            .match-victory {
                min-width: 90vw;
            }
            
            .victory-content {
                padding: 30px 20px;
            }
            
            .victory-player {
                min-width: auto;
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .victory-player-info {
                text-align: center;
            }
            
            .victory-avatar {
                width: 60px;
                height: 60px;
            }
            
            .victory-player-name {
                font-size: 18px;
            }
            
            .victory-score-display {
                font-size: 24px;
            }
            
            .victory-header .victory-title {
                font-size: 24px;
            }
            
            .brb-title {
                font-size: 36px;
            }

            .welcome-logo {
                font-size: 48px;
            }

            .welcome-subtitle {
                font-size: 20px;
            }

            .welcome-year {
                font-size: 28px;
            }

            .outro-title {
                font-size: 40px;
            }

            .outro-subtitle {
                font-size: 24px;
            }
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Current Map Display */
        .current-map-display {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100vw;
            height: 15vh;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.8) 60%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 100;
            margin: 0;
            padding: 0;
        }

        .current-map-container {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.95), rgba(139, 92, 246, 0.95));
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.6);
            margin: 0;
            padding: 40px 60px;
        }

        .current-map-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .current-map-title {
            font-family: 'Inter', sans-serif;
            font-size: 32px;
            font-weight: 800;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
            margin-bottom: 8px;
            line-height: 1.1;
        }

        .current-map-artist {
            font-family: 'Inter', sans-serif;
            font-size: 20px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
        }

        .current-map-difficulty {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 25px;
            display: inline-block;
        }

        .current-map-tiebreaker {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.95), rgba(217, 119, 6, 0.95)) !important;
            border: 3px solid rgba(252, 211, 77, 0.6) !important;
        }

        .current-map-tiebreaker .current-map-label {
            color: rgba(254, 243, 199, 0.9);
        }

        .current-map-tiebreaker .current-map-label::before {
            content: "⚡ ";
        }

        .current-map-tiebreaker .current-map-label::after {
            content: " ⚡";
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="welcome-screen hidden" id="welcomeScreen">
        <div class="welcome-content">
            <div class="welcome-logo">SWEF</div>
            <div class="welcome-subtitle">Sand World OSU Cup</div>
            <div class="welcome-year">2025</div>
            <div class="welcome-message">Welcome to the ultimate rhythm tournament!</div>
        </div>
    </div>

    <!-- Main Match HUD -->
    <div class="match-hud" id="matchHud">
        <div class="hud-container">
            <div class="bracket-info" id="bracketInfo">
                SWEF CUP 2025 - Upper Bracket - Round 1
            </div>
            
            <div class="players-container">
                <!-- Player 1 -->
                <div class="player" id="player1">
                    <img class="player-avatar" id="p1Avatar" src="" alt="Player 1" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IiMzNzM3MzciLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1zbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSIxMiIgeT0iMTIiPgo8cGF0aCBkPSJNMTIgMTJDMTQuNzYxNCAxMiAxNyA5Ljc2MTQyIDE3IDdDMTcgNC4yMzg1OCAxNC43NjE0IDIgMTIgMkM5LjIzODU4IDIgNyA0LjIzODU4IDcgN0M3IDkuNzYxNDIgOS4yMzg1OCAxMiAxMiAxMloiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8cGF0aCBkPSJNMTIgMTRDOC4xMzQwMSAxNCA1IDE3LjEzNDEgNSAyMUg5SDE1SDE5QzE5IDE3LjEzNDEgMTUuODY2IDE0IDEyIDE0WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+Cjwvc3ZnPgo8L3N2Zz4K'">
                    <div class="player-info">
                        <div class="player-name" id="p1Name">Player 1</div>
                        <div class="player-seed" id="p1Seed">Seed #1</div>
                    </div>
                </div>

                <!-- Score Section -->
                <div class="score-section">
                    <div class="score-label">Best of 7</div>
                    <div class="current-score" id="currentScore">0 - 0</div>
                    <div class="score-tracker" id="scoreTracker">
                        <!-- Dots will be generated by JS -->
                    </div>
                </div>

                <!-- Player 2 -->
                <div class="player" id="player2">
                    <div class="player-info" style="text-align: right;">
                        <div class="player-name" id="p2Name">Player 2</div>
                        <div class="player-seed" id="p2Seed">Seed #2</div>
                    </div>
                    <img class="player-avatar" id="p2Avatar" src="" alt="Player 2" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IiMzNzM3MzciLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1zbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSIxMiIgeT0iMTIiPgo8cGF0aCBkPSJNMTIgMTJDMTQuNzYxNCAxMiAxNyA5Ljc2MTQyIDE3IDdDMTcgNC4yMzg1OCAxNC43NjE0IDIgMTIgMkM5LjIzODU4IDIgNyA0LjIzODU4IDcgN0M3IDkuNzYxNDIgOS4yMzg1OCAxMiAxMiAxMloiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8cGF0aCBkPSJNMTIgMTRDOC4xMzQwMSAxNCA1IDE3LjEzNDEgNSAyMUg5SDE1SDE5QzE5IDE3LjEzNDEgMTUuODY2IDE0IDEyIDE0WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+Cjwvc3ZnPgo8L3N2Zz4K'">
                </div>
            </div>
        </div>
    </div>

    <!-- Map Victory Screen -->
    <div class="victory-screen hidden" id="mapVictory">
        <div class="victory-title" id="mapWinner">Player 1 Wins!</div>
        <div class="victory-subtitle" id="mapDetails">Map Title - [Difficulty]</div>
        <div class="victory-details" id="mapStats">Score: 1,234,567 | Accuracy: 98.5%</div>
    </div>

    <!-- Match Victory Screen -->
    <div class="victory-screen match-victory hidden" id="matchVictory">
        <div class="victory-header">
            <div class="victory-title" id="matchVictoryTitle">Match Complete!</div>
        </div>
        <div class="victory-content">
            <div class="victory-player" id="victoryPlayerInfo">
                <img class="victory-avatar" id="victoryAvatar" src="" alt="Winner" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IiMzNzM3MzciLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1zbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSIxMiIgeT0iMTIiPgo8cGF0aCBkPSJNMTIgMTJDMTQuNzYxNCAxMiAxNyA5Ljc2MTQyIDE3IDdDMTcgNC4yMzg1OCAxNC43NjE0IDIgMTIgMkM5LjIzODU4IDIgNyA0LjIzODU4IDcgN0M3IDkuNzYxNDIgOS4yMzg1OCAxMiAxMiAxMloiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8cGF0aCBkPSJNMTIgMTRDOC4xMzQwMSAxNCA1IDE3LjEzNDEgNSAyMUg5SDE1SDE5QzE5IDE3LjEzNDEgMTUuODY2IDE0IDEyIDE0WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+Cjwvc3ZnPgo8L3N2Zz4K'">
                <div class="victory-player-info">
                    <div class="victory-player-name" id="matchWinner">Player 1 Wins!</div>
                    <div class="victory-player-seed" id="winnerSeed">Seed #1</div>
                </div>
                <div class="victory-score-display" id="finalScore">4-2</div>
            </div>
            <div class="victory-advancement" id="advancement">Advances to Round 2</div>
        </div>
    </div>

    <!-- Outro Screen -->
    <div class="outro-screen hidden" id="outroScreen">
        <div class="outro-content">
            <div class="outro-title">Tournament Complete!</div>
            <div class="outro-subtitle">Congratulations Champion!</div>
            <div class="outro-message">Thank you for watching the Sand World OSU Cup 2025</div>
            <div class="outro-thanks">See you next tournament!</div>
        </div>
    </div>

    <!-- AFK Screen -->
    <div class="afk-screen hidden" id="afkScreen">
        <div class="brb-content">
            <div class="brb-title">Be Right Back</div>
            <div class="tournament-title">Sand World OSU Cup 2025</div>
            <div class="next-match" id="nextMatch">Loading tournament data...</div>
        </div>
    </div>

    <!-- Match Interface Overlay -->
    <div class="match-interface-overlay hidden" id="matchInterfaceOverlay">
        <div class="interface-container">
            <div class="interface-header">
                <div class="phase-indicator" id="overlayPhaseIndicator">
                    🚫 Ban Phase
                </div>
                <div class="turn-indicator" id="overlayTurnIndicator">
                    Player 1's Turn
                </div>
            </div>
            
            <div class="mappool-section">
                <div class="mappool-grid">
                    <!-- Player 1 Maps -->
                    <div class="player-mappool">
                        <div class="mappool-header">
                            <span id="overlayP1Name">Player 1</span> Maps
                        </div>
                        <div class="maps-grid" id="overlayP1Maps">
                            <!-- Maps will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Center Action Feed -->
                    <div class="action-feed-section">
                        <div class="action-feed-header">Match Progress</div>
                        <div class="action-feed" id="overlayActionFeed">
                            <div class="action-item system">
                                🎲 Match starting soon...
                            </div>
                        </div>
                        
                        <!-- Picked Maps Display -->
                        <div class="picked-maps-section" id="overlayPickedMaps">
                            <div class="picked-maps-header">Picked Maps</div>
                            <div class="picked-maps-list" id="overlayPickedMapsList">
                                <!-- Picked maps will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Player 2 Maps -->
                    <div class="player-mappool">
                        <div class="mappool-header">
                            <span id="overlayP2Name">Player 2</span> Maps
                        </div>
                        <div class="maps-grid" id="overlayP2Maps">
                            <!-- Maps will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Current Map Display -->
    <div id="currentMapDisplay" class="current-map-display hidden">
        <div id="currentMapContainer" class="current-map-container">
            <div class="current-map-label">Now Playing</div>
            <div id="currentMapTitle" class="current-map-title"></div>
            <div id="currentMapArtist" class="current-map-artist"></div>
            <div id="currentMapDifficulty" class="current-map-difficulty"></div>
        </div>
    </div>

    <script>
        // HTTP Polling for Namecheap compatibility (no SocketIO)
        let isConnected = false;
        let pollingInterval = null;
        let lastUpdateTime = '';
        
        // Start polling for match data
        function startPolling() {
            console.log('Starting HTTP polling for match data...');
            isConnected = true;
            
            // Poll immediately
            pollMatchData();
            
            // Then poll every 3 seconds
            pollingInterval = setInterval(pollMatchData, 3000);
        }
        
        function stopPolling() {
            console.log('Stopping HTTP polling');
            isConnected = false;
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }
        
        async function pollMatchData() {
            try {
                // Poll match data
                const matchResponse = await fetch('/api/match-data');
                if (!matchResponse.ok) {
                    throw new Error(`HTTP error! status: ${matchResponse.status}`);
                }
                
                const matchData = await matchResponse.json();
                
                // Store previous match state for comparison
                if (!window.lastMatchState) {
                    window.lastMatchState = {};
                }
                
                // Check if match data has meaningfully changed
                const hasChanged = (
                    matchData.last_updated !== lastUpdateTime ||
                    !window.lastMatchState.score_p1 !== undefined ||
                    matchData.score_p1 !== window.lastMatchState.score_p1 ||
                    matchData.score_p2 !== window.lastMatchState.score_p2 ||
                    matchData.player1?.name !== window.lastMatchState.player1_name ||
                    matchData.player2?.name !== window.lastMatchState.player2_name ||
                    matchData.status !== window.lastMatchState.status
                );
                
                if (hasChanged) {
                    lastUpdateTime = matchData.last_updated;
                    
                    // Store current state for next comparison
                    window.lastMatchState = {
                        score_p1: matchData.score_p1,
                        score_p2: matchData.score_p2,
                        player1_name: matchData.player1?.name,
                        player2_name: matchData.player2?.name,
                        status: matchData.status
                    };
                    
                    if (matchData.match_found) {
                        updateOverlay(matchData);
                        console.log('Overlay updated - scores:', matchData.score_p1, 'vs', matchData.score_p2);
                    } else {
                        console.log('No active match:', matchData.message);
                        showNoMatchMessage();
                    }
                } else {
                    console.log('No changes detected in match data');
                }
                
                // Poll overlay events
                const eventsResponse = await fetch('/api/overlay-events');
                if (eventsResponse.ok) {
                    const eventsData = await eventsResponse.json();
                    handleOverlayEvents(eventsData.events);
                }
                
                // Ensure we're connected
                if (!isConnected) {
                    console.log('Reconnected to server via polling');
                    isConnected = true;
                }
                
            } catch (error) {
                console.error('Polling error:', error);
                if (isConnected) {
                    console.log('Disconnected from server - polling failed');
                    isConnected = false;
                }
                // Continue polling even on error
            }
        }
        
        let processedEvents = new Set();
        
        function handleOverlayEvents(events) {
            events.forEach(event => {
                const eventId = `${event.type}-${event.timestamp}`;
                
                // Skip if already processed
                if (processedEvents.has(eventId)) {
                    return;
                }
                
                processedEvents.add(eventId);
                
                // Handle different event types
                switch(event.type) {
                    case 'toggle_afk':
                        toggleAFK();
                        break;
                    case 'exit_afk':
                        exitAFK();
                        break;
                    case 'hide_victory_screens':
                        hideVictoryScreens();
                        break;
                    case 'flip_players':
                        flipPlayers();
                        break;
                    case 'show_welcome':
                        showWelcomeScreen();
                        break;
                    case 'show_outro':
                        showOutroScreen(event.data);
                        break;
                    case 'hide_welcome':
                        hideWelcomeScreen();
                        break;
                    case 'hide_outro':
                        hideOutroScreen();
                        break;
                    case 'show_match_interface':
                        showMatchInterface();
                        break;
                    case 'hide_match_interface':
                        hideMatchInterface();
                        break;
                    case 'map_victory':
                        if (event.data) {
                            showMapVictory(event.data.winner, event.data.map_info);
                        }
                        break;
                    case 'match_victory':
                        if (event.data) {
                            showMatchVictory(event.data.winner, event.data.final_score, event.data.advancement);
                        }
                        break;
                }
            });
            
            // Clean up old processed events (keep last 50)
            if (processedEvents.size > 50) {
                const eventsArray = Array.from(processedEvents);
                processedEvents = new Set(eventsArray.slice(-50));
            }
        }
        
        // Simulate SocketIO events for compatibility
        const socket = {
            connected: () => isConnected,
            emit: (event, data) => {
                console.log('Simulated emit:', event, data);
                // Handle specific events that were previously sent via SocketIO
                if (event === 'join_overlay') {
                    // Just start polling
                    return;
                }
            }
        };
        
        // Start polling when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Tournament overlay loaded - starting HTTP polling');
            startPolling();
            // Create initial empty score tracker
            updateScoreTracker(0, 0);
        });
        
        // Stop polling when page unloads
        window.addEventListener('beforeunload', function() {
            stopPolling();
        });

        // Function to swap player UI elements (for admin controls)
        function flipPlayers() {
            const p1NameEl = document.getElementById('p1Name');
            const p2NameEl = document.getElementById('p2Name');
            const p1Avatar = document.getElementById('p1Avatar');
            const p2Avatar = document.getElementById('p2Avatar');
            const p1SeedEl = document.getElementById('p1Seed');
            const p2SeedEl = document.getElementById('p2Seed');
            const player1El = document.getElementById('player1');
            const player2El = document.getElementById('player2');
            // Swap player names
            [p1NameEl.textContent, p2NameEl.textContent] = [p2NameEl.textContent, p1NameEl.textContent];
            // Swap avatars
            [p1Avatar.src, p2Avatar.src] = [p2Avatar.src, p1Avatar.src];
            // Swap seeds
            [p1SeedEl.textContent, p2SeedEl.textContent] = [p2SeedEl.textContent, p1SeedEl.textContent];
            // Swap winning highlight if present
            const p1Win = player1El.classList.contains('winning');
            const p2Win = player2El.classList.contains('winning');
            if (p1Win !== p2Win) {
                player1El.classList.toggle('winning');
                player2El.classList.toggle('winning');
            }
            // Swap the score display and tracker
            const scoreEl = document.getElementById('currentScore');
            // parse "X - Y"
            const [s1, s2] = scoreEl.textContent.split(' - ').map(n => parseInt(n, 10) || 0);
            // rewrite text flipped
            scoreEl.textContent = `${s2} - ${s1}`;
            // rebuild dots flipped
            updateScoreTracker(s2, s1);
        }
        
        function updateOverlay(matchData) {
            // Update player info with animations
            const p1Name = document.getElementById('p1Name');
            const p2Name = document.getElementById('p2Name');
            const p1Avatar = document.getElementById('p1Avatar');
            const p2Avatar = document.getElementById('p2Avatar');
            const p1Seed = document.getElementById('p1Seed');
            const p2Seed = document.getElementById('p2Seed');
            
            // Animate changes if different
            if (p1Name.textContent !== matchData.player1.name) {
                p1Name.classList.add('slide-up');
                p1Name.textContent = matchData.player1.name;
                setTimeout(() => p1Name.classList.remove('slide-up'), 500);
            }
            
            if (p2Name.textContent !== matchData.player2.name) {
                p2Name.classList.add('slide-up');
                p2Name.textContent = matchData.player2.name;
                setTimeout(() => p2Name.classList.remove('slide-up'), 500);
            }
            
            p1Avatar.src = matchData.player1.avatar_url || '';
            p2Avatar.src = matchData.player2.avatar_url || '';
            p1Seed.textContent = `Seed #${matchData.player1.seed}`;
            p2Seed.textContent = `Seed #${matchData.player2.seed}`;
            
            // Update bracket info
            document.getElementById('bracketInfo').textContent = 
                `SWEF CUP 2025 - ${matchData.bracket} Bracket - Round ${matchData.round_index + 1}`;
            
            // Only update score tracker if scores actually changed
            const currentScore = document.getElementById('currentScore').textContent;
            const newScore = `${matchData.score_p1} - ${matchData.score_p2}`;
            
            if (currentScore !== newScore) {
                // Scores changed - update tracker with animation
                updateScoreTracker(matchData.score_p1, matchData.score_p2);
                
                // Update current score with animation
                const scoreElement = document.getElementById('currentScore');
                scoreElement.classList.add('pulse');
                scoreElement.textContent = newScore;
                setTimeout(() => scoreElement.classList.remove('pulse'), 1000);
            }
            
            // Update player states (winning/losing)
            const player1El = document.getElementById('player1');
            const player2El = document.getElementById('player2');
            
            player1El.classList.remove('winning');
            player2El.classList.remove('winning');
            
            if (matchData.score_p1 > matchData.score_p2) {
                player1El.classList.add('winning');
            } else if (matchData.score_p2 > matchData.score_p1) {
                player2El.classList.add('winning');
            }
            
            // Update AFK screen next match info
            updateNextMatchInfo(matchData);
            
            // Update current map display based on match data
            updateCurrentMapDisplay(matchData);
                
            // Show the HUD if it was hidden
            document.getElementById('matchHud').classList.remove('hidden');
        }
        
        function updateNextMatchInfo(currentMatchData) {
            const nextMatchElement = document.getElementById('nextMatch');
            
            // If current match is in progress, show it
            if (currentMatchData.status === 'in_progress') {
                nextMatchElement.textContent = `Now: ${currentMatchData.player1.name} vs ${currentMatchData.player2.name}`;
            } else if (currentMatchData.status === 'next_up') {
                nextMatchElement.textContent = `Next: ${currentMatchData.player1.name} vs ${currentMatchData.player2.name}`;
            } else {
                nextMatchElement.textContent = 'Tournament in progress...';
            }
        }
        
        function showNoMatchMessage() {
            // Hide HUD when no match is active
            document.getElementById('matchHud').classList.add('hidden');
            
            // Update AFK screen to show no active match
            const nextMatchElement = document.getElementById('nextMatch');
            nextMatchElement.textContent = 'No active matches - Stay tuned!';
        }
        
        function updateScoreTracker(score1, score2) {
            const tracker = document.getElementById('scoreTracker');
            tracker.innerHTML = '';
            
            // Create 7 dots for Best of 7
            for (let i = 0; i < 7; i++) {
                const dot = document.createElement('div');
                dot.className = 'score-dot';
                
                // Player 1 wins come from the left (positions 0, 1, 2, 3...)
                // Player 2 wins come from the right (positions 6, 5, 4, 3...)
                if (i < score1) {
                    // Player 1 win - fill from left
                    setTimeout(() => {
                        dot.classList.add('p1-win');
                    }, i * 50);
                } else if (i >= (7 - score2)) {
                    // Player 2 win - fill from right
                    setTimeout(() => {
                        dot.classList.add('p2-win');
                    }, (6 - i) * 50);
                }
                
                tracker.appendChild(dot);
            }
        }
        
        function showMapVictory(winner, mapInfo) {
            const screen = document.getElementById('mapVictory');
            const winnerElement = document.getElementById('mapWinner');
            const detailsElement = document.getElementById('mapDetails');
            
            winnerElement.textContent = `${winner} Wins!`;
            detailsElement.textContent = mapInfo.title || 'Map Complete';
            
            screen.classList.remove('hidden');
            screen.classList.add('fade-in');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                screen.classList.add('hidden');
                screen.classList.remove('fade-in');
            }, 5000);
        }
        
        function showMatchVictory(winner, finalScore, advancement = "") {
            console.log('Showing match victory:', { winner, finalScore, advancement });
            
            const screen = document.getElementById('matchVictory');
            const winnerElement = document.getElementById('matchWinner');
            const scoreElement = document.getElementById('finalScore');
            const advancementElement = document.getElementById('advancement');
            const avatarElement = document.getElementById('victoryAvatar');
            const seedElement = document.getElementById('winnerSeed');
            
            // Get current match data to find winner's info
            const p1Name = document.getElementById('p1Name').textContent;
            const p2Name = document.getElementById('p2Name').textContent;
            const p1Avatar = document.getElementById('p1Avatar').src;
            const p2Avatar = document.getElementById('p2Avatar').src;
            const p1Seed = document.getElementById('p1Seed').textContent;
            const p2Seed = document.getElementById('p2Seed').textContent;
            
            // Determine winner's avatar and seed
            let winnerAvatar = '';
            let winnerSeedText = '';
            
            if (winner === p1Name) {
                winnerAvatar = p1Avatar;
                winnerSeedText = p1Seed;
            } else if (winner === p2Name) {
                winnerAvatar = p2Avatar;
                winnerSeedText = p2Seed;
            }
            
            // Clear any existing classes and force visibility
            screen.className = 'victory-screen match-victory';
            screen.style.display = 'block';
            screen.style.opacity = '1';
            
            // Update content
            winnerElement.textContent = `${winner} Wins!`;
            scoreElement.textContent = finalScore;
            advancementElement.textContent = advancement || '';
            avatarElement.src = winnerAvatar || '';
            seedElement.textContent = winnerSeedText || '';
            
            // Force reflow and add animation
            screen.offsetHeight;
            screen.classList.add('fade-in');
            
            console.log('Match victory screen should now be visible');
        }
        
        function showWelcomeScreen() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const matchHud = document.getElementById('matchHud');
            const afkScreen = document.getElementById('afkScreen');
            
            // Hide other screens
            matchHud.classList.add('hidden');
            afkScreen.classList.add('hidden');
            hideVictoryScreens();
            
            welcomeScreen.classList.remove('hidden');
            console.log('Welcome screen shown');
        }
        
        function hideWelcomeScreen() {
            const welcomeScreen = document.getElementById('welcomeScreen');
            welcomeScreen.classList.add('hidden');
            console.log('Welcome screen hidden');
        }
        
        function showOutroScreen(data = {}) {
            const outroScreen = document.getElementById('outroScreen');
            const matchHud = document.getElementById('matchHud');
            const afkScreen = document.getElementById('afkScreen');
            
            // Hide other screens
            matchHud.classList.add('hidden');
            afkScreen.classList.add('hidden');
            hideVictoryScreens();
            
            // Update outro content if data provided
            if (data.champion) {
                const championElement = document.querySelector('.outro-subtitle');
                championElement.textContent = `Congratulations ${data.champion}!`;
            }
            
            if (data.message) {
                const messageElement = document.querySelector('.outro-message');
                messageElement.textContent = data.message;
            }
            
            outroScreen.classList.remove('hidden');
            
            // Add confetti effect
            createConfetti();
            
            console.log('Outro screen shown');
        }
        
        function hideOutroScreen() {
            const outroScreen = document.getElementById('outroScreen');
            outroScreen.classList.add('hidden');
            console.log('Outro screen hidden');
        }
        
        function createConfetti() {
            const outroScreen = document.getElementById('outroScreen');
            
            // Create confetti particles
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                outroScreen.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    if (outroScreen.contains(confetti)) {
                        outroScreen.removeChild(confetti);
                    }
                }, 5000);
            }
        }
        
        function toggleAFK() {
            const afkScreen = document.getElementById('afkScreen');
            const matchHud = document.getElementById('matchHud');
            
            if (afkScreen.classList.contains('hidden')) {
                afkScreen.classList.remove('hidden');
                afkScreen.classList.add('fade-in');
                matchHud.classList.add('hidden');
            } else {
                afkScreen.classList.add('hidden');
                afkScreen.classList.remove('fade-in');
                matchHud.classList.remove('hidden');
            }
        }
        
        function exitAFK() {
            const afkScreen = document.getElementById('afkScreen');
            const matchHud = document.getElementById('matchHud');
            
            // Force exit AFK screen and show match HUD
            afkScreen.classList.add('hidden');
            afkScreen.classList.remove('fade-in');
            matchHud.classList.remove('hidden');
            
            console.log('Exited AFK screen - showing match HUD');
        }
        
        function hideVictoryScreens() {
            document.getElementById('mapVictory').classList.add('hidden');
            document.getElementById('matchVictory').classList.add('hidden');
        }

        function showMatchInterface() {
            const interfaceOverlay = document.getElementById('matchInterfaceOverlay');
            const matchHud = document.getElementById('matchHud');
            const afkScreen = document.getElementById('afkScreen');
            
            // Hide other screens
            hideVictoryScreens();
            afkScreen.classList.add('hidden');
            matchHud.classList.add('hidden');
            
            // Show interface overlay
            interfaceOverlay.classList.remove('hidden');
            
            // Start polling for match interface data
            startMatchInterfacePolling();
            
            console.log('Match interface overlay shown');
        }

        function hideMatchInterface() {
            const interfaceOverlay = document.getElementById('matchInterfaceOverlay');
            const matchHud = document.getElementById('matchHud');
            
            interfaceOverlay.classList.add('hidden');
            matchHud.classList.remove('hidden');
            
            // Stop polling for match interface data
            stopMatchInterfacePolling();
            
            console.log('Match interface overlay hidden');
        }

        let matchInterfacePolling = null;
        let interfaceLockTimer = null;
        let wasInterfaceLocked = false;

        function startMatchInterfacePolling() {
            if (matchInterfacePolling) return;
            
            // Poll immediately
            pollMatchInterfaceData();
            
            // Then poll every 2 seconds for more responsive updates
            matchInterfacePolling = setInterval(pollMatchInterfaceData, 2000);
        }

        function stopMatchInterfacePolling() {
            if (matchInterfacePolling) {
                clearInterval(matchInterfacePolling);
                matchInterfacePolling = null;
            }
            
            // Clear any pending lock timer
            if (interfaceLockTimer) {
                clearTimeout(interfaceLockTimer);
                interfaceLockTimer = null;
            }
        }

        async function pollMatchInterfaceData() {
            try {
                // Poll match interface state directly
                const response = await fetch('/api/match-interface-state');
                if (!response.ok) return;
                
                const data = await response.json();
                if (!data.match_found) return;
                
                updateMatchInterface(data);
                
            } catch (error) {
                console.error('Match interface polling error:', error);
            }
        }

        let currentlySelectedMap = null;
        let currentMapDisplayVisible = false;

        function updateCurrentMapDisplay(data) {
            const mapDisplay = document.getElementById('currentMapDisplay');
            const mapContainer = document.getElementById('currentMapContainer');
            const mapTitle = document.getElementById('currentMapTitle');
            const mapArtist = document.getElementById('currentMapArtist');
            const mapDifficulty = document.getElementById('currentMapDifficulty');
            
            console.log('updateCurrentMapDisplay called with:', {
                has_current_map: !!data.current_map,
                current_map: data.current_map,
                is_tiebreaker: data.is_tiebreaker,
                tiebreaker_url: data.tiebreaker_map_url,
                interface_locked: data.interface_locked,
                phase: data.phase
            });
            
            // Check if there's a current map being played
            let selectedMap = null;
            let isTiebreaker = false;
            let shouldShow = false;
            
            // Check for tiebreaker first
            if (data.is_tiebreaker && data.tiebreaker_map_url) {
                selectedMap = {
                    title: "Tiebreaker Map",
                    artist: "Custom Selection", 
                    version: "Tiebreaker",
                    beatmap_url: data.tiebreaker_map_url
                };
                isTiebreaker = true;
                shouldShow = true; // Always show tiebreaker
            } else if (data.current_map) {
                // Use the current map from the API
                selectedMap = data.current_map;
                // Show if interface is locked (map is being played) or we have picked maps
                shouldShow = data.interface_locked === true || (data.picked_maps && data.picked_maps.length > 0);
            }
            
            if (selectedMap && shouldShow && (selectedMap !== currentlySelectedMap || shouldShow !== window.lastShouldShow)) {
                // Show the map display
                mapTitle.textContent = selectedMap.title || 'Unknown Title';
                mapArtist.textContent = selectedMap.artist || 'Unknown Artist';
                mapDifficulty.textContent = selectedMap.version || selectedMap.difficulty_name || 'Unknown Difficulty';
                
                // Update container styling for tiebreaker
                if (isTiebreaker) {
                    mapContainer.className = 'current-map-container current-map-tiebreaker';
                    document.querySelector('.current-map-label').textContent = 'TIEBREAKER';
                } else if (data.interface_locked === true) {
                    mapContainer.className = 'current-map-container';
                    document.querySelector('.current-map-label').textContent = 'NOW PLAYING';
                } else {
                    mapContainer.className = 'current-map-container';
                    document.querySelector('.current-map-label').textContent = 'SELECTED';
                }
                
                mapDisplay.classList.remove('hidden');
                currentMapDisplayVisible = true;
                currentlySelectedMap = selectedMap;
                window.lastShouldShow = shouldShow;
                
                console.log('Showing current map display:', {
                    title: selectedMap.title,
                    artist: selectedMap.artist,
                    difficulty: selectedMap.version || selectedMap.difficulty_name,
                    isTiebreaker: isTiebreaker,
                    shouldShow: shouldShow,
                    interface_locked: data.interface_locked
                });
                
            } else if ((!selectedMap || !shouldShow) && currentMapDisplayVisible) {
                // Hide the map display when no map is selected or shouldn't show
                mapDisplay.classList.add('hidden');
                currentMapDisplayVisible = false;
                currentlySelectedMap = null;
                window.lastShouldShow = false;
                console.log('Hiding current map display - no current map or should not show');
            }
        }

        function updateMatchInterface(data) {
            console.log('Match interface update received:', {
                match_found: data.match_found,
                phase: data.phase,
                current_turn: data.current_turn,
                mappool_length: data.mappool?.length || 0,
                banned_count: data.banned_maps?.length || 0,
                picked_count: data.picked_maps?.length || 0,
                interface_locked: data.interface_locked
            });
            
            // Handle interface lock state changes
            handleInterfaceLockState(data.interface_locked);
            
            // Update current map display
            updateCurrentMapDisplay(data);
            
            // Update player names
            document.getElementById('overlayP1Name').textContent = data.player1?.name || 'Player 1';
            document.getElementById('overlayP2Name').textContent = data.player2?.name || 'Player 2';
            
            // Update phase indicator
            updatePhaseIndicator(data);
            
            // Update turn indicator
            updateTurnIndicator(data);
            
            // Update mappool display
            updateMappoolDisplay(data);
            
            // Update picked maps display
            updatePickedMapsDisplay(data);
            
            // Update action feed
            updateActionFeed(data);
            
            // Update ability status
            updateAbilityStatus(data);
        }

        function handleInterfaceLockState(isCurrentlyLocked) {
            // Check if interface lock state changed
            if (isCurrentlyLocked && !wasInterfaceLocked) {
                // Interface just became locked - start 5 second timer
                console.log('Interface became locked - starting 5 second minimize timer');
                
                // Clear any existing timer
                if (interfaceLockTimer) {
                    clearTimeout(interfaceLockTimer);
                }
                
                // Set new timer to minimize overlay after 5 seconds
                interfaceLockTimer = setTimeout(() => {
                    console.log('5 seconds elapsed - minimizing match interface overlay');
                    hideMatchInterface();
                }, 5000);
                
            } else if (!isCurrentlyLocked && wasInterfaceLocked) {
                // Interface unlocked - cancel the minimize timer
                console.log('Interface unlocked - cancelling minimize timer');
                if (interfaceLockTimer) {
                    clearTimeout(interfaceLockTimer);
                    interfaceLockTimer = null;
                }
            }
            
            // Update state for next comparison
            wasInterfaceLocked = isCurrentlyLocked;
        }

        function updatePhaseIndicator(data) {
            const indicator = document.getElementById('overlayPhaseIndicator');
            
            if (!data.phase) return;
            
            const phase = data.phase;
            const bannedCount = data.banned_maps?.length || 0;
            const pickedCount = data.picked_maps?.length || 0;
            const isLocked = data.interface_locked;
            
            indicator.className = 'phase-indicator';
            
            if (isLocked) {
                indicator.textContent = `🎮 Play Starting Soon...`;
                indicator.classList.add('play-starting');
            } else if (phase === 'ban') {
                indicator.textContent = `🚫 Ban Phase (${bannedCount}/6)`;
                indicator.classList.add('ban-phase');
            } else if (phase === 'pick') {
                indicator.textContent = `🎯 Pick Phase`;
                indicator.classList.add('pick-phase');
            } else if (phase === 'play') {
                indicator.textContent = `🎮 Play Phase`;
                indicator.classList.add('play-phase');
            }
        }

        function updateTurnIndicator(data) {
            const indicator = document.getElementById('overlayTurnIndicator');
            
            if (!data.current_turn) return;
            
            const currentTurn = data.current_turn;
            const phase = data.phase || 'ban';
            
            let playerName = 'Unknown Player';
            if (currentTurn === 'player1') {
                playerName = data.player1?.name || 'Player 1';
            } else if (currentTurn === 'player2') {
                playerName = data.player2?.name || 'Player 2';
            }
            
            if (phase === 'ban') {
                indicator.textContent = `${playerName}'s turn to ban`;
            } else if (phase === 'pick') {
                indicator.textContent = `${playerName}'s turn to pick`;
            } else {
                indicator.textContent = 'Waiting for match result...';
            }
        }

        function updateMappoolDisplay(data) {
            // Use actual mappool data from the API
            const mappoolData = data.mappool || {};
            
            // Convert mappool object to array for easier handling
            let mappoolArray = [];
            if (Array.isArray(mappoolData)) {
                mappoolArray = mappoolData;
            } else if (typeof mappoolData === 'object') {
                // Flatten all categories into a single array
                for (const [category, maps] of Object.entries(mappoolData)) {
                    if (Array.isArray(maps)) {
                        mappoolArray = mappoolArray.concat(maps);
                    }
                }
            }
            
            console.log('Updating mappool display with data:', {
                mappool_length: mappoolArray.length,
                mappool_sample: mappoolArray.slice(0, 2),
                banned_maps: data.banned_maps,
                picked_maps: data.picked_maps,
                full_data: data
            });
            
            if (mappoolArray.length === 0) {
                console.log('No mappool data received - setting empty state');
                document.getElementById('overlayP1Maps').innerHTML = '<div class="no-maps">No maps available</div>';
                document.getElementById('overlayP2Maps').innerHTML = '<div class="no-maps">No maps available</div>';
                return;
            }
            
            // Update Player 1 maps (first half of mappool)
            updatePlayerMapsFromPool('overlayP1Maps', mappoolArray.slice(0, Math.ceil(mappoolArray.length / 2)), data);
            
            // Update Player 2 maps (second half of mappool)
            updatePlayerMapsFromPool('overlayP2Maps', mappoolArray.slice(Math.ceil(mappoolArray.length / 2)), data);
        }

        function updatePlayerMapsFromPool(containerId, maps, data) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.log('Container not found:', containerId);
                return;
            }
            
            console.log(`Updating ${containerId} with ${maps.length} maps:`, maps.slice(0, 2));
            
            const bannedMaps = data.banned_maps || [];
            const pickedMaps = data.picked_maps || [];
            
            container.innerHTML = '';
            maps.forEach((map, index) => {
                const mapDiv = document.createElement('div');
                mapDiv.className = 'overlay-map-card';
                mapDiv.id = `overlay-map-${map.id}`;
                
                // Check if map is banned or picked
                const isBanned = bannedMaps.includes(map.id.toString());
                const pickedInfo = pickedMaps.find(p => p.map_id === map.id.toString());
                
                if (isBanned) {
                    mapDiv.classList.add('banned');
                } else if (pickedInfo) {
                    mapDiv.classList.add('picked');
                    if (pickedInfo.picked_by === 'player1') {
                        mapDiv.classList.add('picked-p1');
                    } else {
                        mapDiv.classList.add('picked-p2');
                    }
                }
                
                mapDiv.innerHTML = `
                    <div class="overlay-map-title">${map.title || 'Unknown'}</div>
                    <div class="overlay-map-artist">${map.artist || 'Unknown'}</div>
                    <div class="overlay-map-diff">[${map.difficulty_name || map.version || 'Unknown'}]</div>
                `;
                
                container.appendChild(mapDiv);
            });
            
            console.log(`Updated ${containerId} with ${container.children.length} map cards`);
        }

        function updateActionFeed(data) {
            const feed = document.getElementById('overlayActionFeed');
            if (!feed) return;
            
            const actionLog = data.action_log || [];
            
            if (actionLog.length === 0) {
                feed.innerHTML = '<div class="action-item system">🎲 Match starting soon...</div>';
                return;
            }
            
            feed.innerHTML = '';
            // Show last 8 actions
            actionLog.slice(-8).reverse().forEach(action => {
                const actionDiv = document.createElement('div');
                actionDiv.className = `action-item ${action.type}`;
                
                let actionText = '';
                if (action.type === 'ban') {
                    actionText = `🚫 ${action.player} banned ${action.map}`;
                } else if (action.type === 'pick') {
                    actionText = `🎯 ${action.player} picked ${action.map}`;
                } else if (action.type === 'ability') {
                    actionText = `⚡ ${action.player} used ${action.ability}`;
                } else if (action.type === 'system') {
                    actionText = `🎲 ${action.message}`;
                }
                
                actionDiv.textContent = actionText;
                feed.appendChild(actionDiv);
            });
        }

        function updatePickedMapsDisplay(data) {
            const container = document.getElementById('overlayPickedMapsList');
            if (!container) return;
            
            const pickedMaps = data.picked_maps || [];
            
            if (pickedMaps.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 12px;">No maps picked yet</div>';
                return;
            }
            
            container.innerHTML = '';
            pickedMaps.forEach((pickedMap, index) => {
                const mapDiv = document.createElement('div');
                mapDiv.className = 'picked-map-item';
                
                // Find map details from mappool
                const mapDetails = data.mappool?.find(m => m.id.toString() === pickedMap.map_id);
                const mapName = mapDetails ? `${mapDetails.title} [${mapDetails.difficulty_name || mapDetails.version}]` : `Map ${pickedMap.map_id}`;
                const pickerName = pickedMap.picked_by === 'player1' ? data.player1?.name || 'Player 1' : data.player2?.name || 'Player 2';
                
                mapDiv.innerHTML = `
                    <div class="picked-map-round">Round ${index + 1}</div>
                    <div class="picked-map-name">${mapName}</div>
                    <div class="picked-map-picker">Picked by ${pickerName}</div>
                `;
                
                container.appendChild(mapDiv);
            });
        }

        function updateAbilityStatus(data) {
            // Update ability status display if needed
            const abilitiesUsed = data.abilities_used || {};
            
            // This would show which abilities have been used by each player
            // Implementation depends on UI requirements
        }

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code&family=Orbitron:wght@600&display=swap');
        body { font-family: 'Fira Code', monospace; background-color: #111827; color: #d1d5db; }
        h1, h2, h3 { font-family: 'Orbitron', sans-serif; }
        .match-card { transition: all 0.3s ease; }
        .match-card:hover { transform: translateY(-2px); }
        .score-input { width: 3rem; }

        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        .animate-pulse {
          animation: pulse 2s infinite;
        }

        /* BYE match styling */
        .player.bye {
          color: #6b7280; /* gray-500 */
          font-style: italic;
        }

        .match .bye-indicator {
          background-color: #3b82f6; /* blue-600 */
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 500;
        }

        /* Make BYE matches slightly transparent */
        .match.bye-match {
          opacity: 0.6;
          border: 1px solid #6b7280;
        }

        /* Dev mode toggle */
        .dev-mode-content {
          display: none;
        }
        .dev-mode-enabled .dev-mode-content {
          display: block;
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl text-yellow-400 mb-8">Tournament Admin Panel</h1>

        <!-- Dev Mode Toggle -->
        <div class="bg-orange-900 border border-orange-600 p-4 rounded-lg mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-bold text-orange-400">üõ†Ô∏è Developer Mode</h3>
                    <p class="text-sm text-orange-200">Enable access to advanced controls and reset functions</p>
                </div>
                <button onclick="toggleDevMode()" id="devModeToggle" 
                        class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded font-bold">
                    Enable Dev Mode
                </button>
            </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mb-4">
            {% for category, message in messages %}
              <div class="p-4 rounded
                {% if category == 'error' %} bg-red-500 text-white
                {% elif category == 'success' %} bg-green-500 text-white
                {% else %} bg-blue-500 text-white {% endif %}">
                {{ message }}
              </div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Twitch Stream Management -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8">
            <h2 class="text-2xl text-pink-500 mb-4">Twitch Stream</h2>
            
            <div class="flex flex-wrap gap-4 items-start mb-6">
                <form action="{{ url_for('admin.set_stream') }}" method="POST" class="flex gap-2">
                    <input type="text" name="twitch_channel" 
                           placeholder="Twitch channel name (e.g., shroud)" 
                           value="{{ data.get('twitch_channel', '') }}"
                           class="bg-gray-900 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-500 w-64">
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Set Channel
                    </button>
                </form>
                
                {% if data.get('twitch_channel') %}
                <form action="{{ url_for('admin.toggle_stream') }}" method="POST" class="inline">
                    <button type="submit" 
                            class="{% if data.get('stream_live') %}bg-red-600 hover:bg-red-700{% else %}bg-green-600 hover:bg-green-700{% endif %} text-white font-bold py-2 px-4 rounded">
                        {% if data.get('stream_live') %}
                            üî¥ Stop Stream
                        {% else %}
                            ‚ñ∂Ô∏è Start Stream
                        {% endif %}
                    </button>
                </form>
                
                <form action="{{ url_for('admin.clear_stream') }}" method="POST" class="inline"
                      onsubmit="return confirm('Clear stream settings?');">
                    <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                        Clear Stream
                    </button>
                </form>
                {% endif %}
            </div>
            
            {% if data.get('twitch_channel') %}
            <div class="bg-gray-700 p-4 rounded mb-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-300 mb-2">
                            Channel: 
                            <a href="https://twitch.tv/{{ data.twitch_channel }}" target="_blank" 
                               class="text-purple-400 hover:text-purple-300">
                                twitch.tv/{{ data.twitch_channel }}
                            </a>
                        </p>
                        <p class="text-xs text-gray-400">
                            Status: 
                            {% if data.get('stream_live') %}
                                <span class="text-red-400 font-bold">üî¥ LIVE - Stream visible on tournament page</span>
                            {% else %}
                                <span class="text-gray-500">‚ö´ OFF - Stream hidden from tournament page</span>
                            {% endif %}
                        </p>
                    </div>
                    
                    {% if data.get('stream_live') %}
                    <div class="text-right">
                        <a href="{{ url_for('public.tournament') }}" target="_blank" 
                           class="text-blue-400 hover:text-blue-300 text-sm">
                            üì∫ View on Tournament Page
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Tournament Settings -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8 dev-mode-content">
            <h2 class="text-2xl text-blue-500 mb-4">üèÜ Tournament Settings</h2>
            
            <!-- Seeding Mappool Management -->
            <div class="bg-gray-700 p-4 rounded-lg mb-4">
                <h3 class="text-lg text-blue-400 mb-3">üéØ Seeding Mappool</h3>
                
                <form action="{{ url_for('admin.set_seeding_playlist') }}" method="POST" class="flex gap-2 mb-3">
                    <input type="url" name="playlist_url" 
                           placeholder="osu! playlist URL (e.g., https://osu.ppy.sh/playlists/123456)" 
                           value="{{ data.get('seeding_playlist_url', '') }}"
                           class="bg-gray-900 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-1">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Update Playlist
                    </button>
                </form>
                
                <div class="flex gap-2">
                    {% if data.get('seeding_playlist_url') %}
                    <a href="{{ data.seeding_playlist_url }}" target="_blank" 
                       class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm">
                        üéµ View Current Playlist
                    </a>
                    <form action="{{ url_for('admin.set_seeding_playlist') }}" method="POST" class="inline"
                          onsubmit="return confirm('Clear seeding playlist URL?');">
                        <input type="hidden" name="playlist_url" value="">
                        <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded text-sm">
                            Clear Playlist
                        </button>
                    </form>
                    {% else %}
                    <p class="text-gray-400 text-sm italic">No seeding playlist set - will show "TBD" on tournament details page</p>
                    {% endif %}
                </div>
                
                <div class="mt-3 text-xs text-gray-400">
                    <p>üí° <strong>Tip:</strong> When a playlist URL is set, the tournament details page will show "Pool has been dropped for practice!" with a link to the playlist.</p>
                </div>
            </div>
        </div>

        <!-- Overlay Controls -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8">
            <h2 class="text-2xl text-green-500 mb-4">üé• Stream Overlay Controls</h2>
            
            <!-- Main Controls -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <!-- AFK Toggle -->
                <form action="{{ url_for('admin.overlay_toggle_afk') }}" method="POST" class="inline">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition-colors">
                        üì∫ Toggle AFK Screen
                    </button>
                </form>
                
                <!-- Hide Victory Screens -->
                <form action="{{ url_for('admin.overlay_hide_victory') }}" method="POST" class="inline">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition-colors">
                        ‚ùå Hide Victory Screens
                    </button>
                </form>
                
                <!-- Show Match Victory -->
                <form action="{{ url_for('admin.overlay_show_match_victory') }}" method="POST" class="inline">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition-colors">
                        üèÜ Show Match Victory
                    </button>
                </form>
                
                <!-- Open Overlay -->
                <a href="{{ url_for('public.tournament_overlay') }}" target="_blank" 
                   class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition-colors text-center inline-block">
                    üñ•Ô∏è Open Overlay
                </a>

                <!-- Flip Players -->
                <form action="{{ url_for('admin.overlay_flip_players') }}" method="POST" class="inline">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded transition-colors">
                        üîÑ Flip Players
                    </button>
                </form>
            </div>

            <!-- Welcome/Outro Screen Controls -->
            <div class="border-t border-gray-600 pt-4">
                <h3 class="text-lg text-blue-400 mb-3">‚ú® Special Screens</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
                    <!-- Welcome Screen -->
                    <form action="{{ url_for('admin.overlay_show_welcome') }}" method="POST" class="inline">
                        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            üåü Show Welcome Screen
                        </button>
                    </form>
                    
                    <form action="{{ url_for('admin.overlay_hide_welcome') }}" method="POST" class="inline">
                        <button type="submit" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            ‚ùå Hide Welcome
                        </button>
                    </form>
                    
                    <!-- Match Interface -->
                    <form action="{{ url_for('admin.overlay_show_match_interface') }}" method="POST" class="inline">
                        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            üéØ Show Match Interface
                        </button>
                    </form>
                    
                    <form action="{{ url_for('admin.overlay_hide_match_interface') }}" method="POST" class="inline">
                        <button type="submit" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            ‚ùå Hide Match Interface
                        </button>
                    </form>
                    
                    <!-- Outro Screen -->
                    <button onclick="showOutroForm()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded transition-colors">
                        üéâ Show Outro Screen
                    </button>
                    
                    <form action="{{ url_for('admin.overlay_hide_outro') }}" method="POST" class="inline">
                        <button type="submit" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            ‚ùå Hide Outro
                        </button>
                    </form>
                </div>
                
                <!-- Outro Form (Hidden by default) -->
                <div id="outroForm" class="mt-4 p-4 bg-gray-700 rounded-lg hidden">
                    <h4 class="text-lg font-semibold mb-3">üèÜ Tournament Outro Details</h4>
                    <form action="{{ url_for('admin.overlay_show_outro') }}" method="POST">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="champion" class="block text-sm font-medium text-gray-300 mb-2">Champion Name:</label>
                                <input type="text" id="champion" name="champion" 
                                       class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-yellow-500"
                                       placeholder="e.g., PlayerName">
                            </div>
                            <div>
                                <label for="message" class="block text-sm font-medium text-gray-300 mb-2">Custom Message:</label>
                                <input type="text" id="message" name="message" 
                                       class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-yellow-500"
                                       placeholder="Thank you for watching the Sand World OSU Cup 2025">
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button type="submit" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded transition-colors">
                                üéâ Show Outro
                            </button>
                            <button type="button" onclick="hideOutroForm()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
        </div>

        <!-- Current Match Management -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8">
            <h2 class="text-2xl text-green-500 mb-4">üéØ Current Match Management</h2>
            {% set ns = namespace(current_match=None, current_bracket_type=None) %}

            {# --- Find the current match with priority: in_progress then next_up --- #}

            {# 1) First look for any in_progress match #}
            {% if not ns.current_match %}
              {% for bracket_type in ['upper','lower','grand_finals'] %}
                {% if bracket_type in data.get('brackets',{}) and not ns.current_match %}
                  {% if bracket_type == 'grand_finals' %}
                    {% set match = data.brackets[bracket_type] %}
                    {% if match and match.status == 'in_progress' %}
                      {% set ns.current_match = match %}
                      {% set ns.current_bracket_type = bracket_type %}
                    {% endif %}
                  {% else %}
                    {% for round_matches in data.brackets[bracket_type] %}
                      {% for match in round_matches %}
                        {% if not ns.current_match and match and match.status == 'in_progress' %}
                          {% set ns.current_match = match %}
                          {% set ns.current_bracket_type = bracket_type %}
                        {% endif %}
                      {% endfor %}
                    {% endfor %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endif %}

            {# 2) If none are in_progress, fall back to next_up #}
            {% if not ns.current_match %}
              {% for bracket_type in ['upper','lower','grand_finals'] %}
                {% if bracket_type in data.get('brackets',{}) and not ns.current_match %}
                  {% if bracket_type == 'grand_finals' %}
                    {% set match = data.brackets[bracket_type] %}
                    {% if match and match.status == 'next_up' %}
                      {% set ns.current_match = match %}
                      {% set ns.current_bracket_type = bracket_type %}
                    {% endif %}
                  {% else %}
                    {% for round_matches in data.brackets[bracket_type] %}
                      {% for match in round_matches %}
                        {% if not ns.current_match and match and match.status == 'next_up' %}
                          {% set ns.current_match = match %}
                          {% set ns.current_bracket_type = bracket_type %}
                        {% endif %}
                      {% endfor %}
                    {% endfor %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endif %}
            
            {% if ns.current_match %}
            <div class="bg-gray-700 p-6 rounded-lg border-2 border-green-500">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="text-xl font-bold text-green-400">{{ ns.current_bracket_type|title|replace('_', ' ') }}</h3>
                        <p class="text-sm text-gray-300">Match ID: {{ ns.current_match.id }}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        {% if ns.current_match.get('status') == 'in_progress' %}
                        <span class="bg-green-600 text-white text-sm px-3 py-1 rounded-full animate-pulse">
                            üî¥ LIVE
                        </span>
                        {% elif ns.current_match.get('status') == 'next_up' %}
                        <span class="bg-yellow-600 text-white text-sm px-3 py-1 rounded-full">
                            ‚è≥ NEXT UP
                        </span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Players and Score -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- Player 1 -->
                    <div class="bg-gray-600 p-4 rounded text-center">
                        {% if ns.current_match.player1 %}
                        <img src="{{ ns.current_match.player1.avatar_url or 'https://osu.ppy.sh/images/layout/avatar-guest.png' }}" 
                             class="w-16 h-16 rounded-full mx-auto mb-2">
                        <h4 class="text-lg font-bold text-yellow-300">{{ ns.current_match.player1.name }}</h4>
                        <p class="text-2xl font-bold text-white">{{ ns.current_match.get('score_p1', 0) }}</p>
                        {% else %}
                        <p class="text-gray-400 italic">TBD</p>
                        {% endif %}
                    </div>
                    
                    <!-- VS and Match Info -->
                    <div class="flex flex-col justify-center items-center text-center">
                        <p class="text-gray-400 text-lg font-bold mb-2">VS</p>
                        <p class="text-sm text-gray-300">Best of 7</p>
                        <p class="text-xs text-gray-400">First to 4 wins</p>
                    </div>
                    
                    <!-- Player 2 -->
                    <div class="bg-gray-600 p-4 rounded text-center">
                        {% if ns.current_match.player2 %}
                        <img src="{{ ns.current_match.player2.avatar_url or 'https://osu.ppy.sh/images/layout/avatar-guest.png' }}" 
                             class="w-16 h-16 rounded-full mx-auto mb-2">
                        <h4 class="text-lg font-bold text-yellow-300">{{ ns.current_match.player2.name }}</h4>
                        <p class="text-2xl font-bold text-white">{{ ns.current_match.get('score_p2', 0) }}</p>
                        {% else %}
                        <p class="text-gray-400 italic">TBD</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Match URL and Actions -->
                <div class="space-y-4">
                    <!-- Multiplayer Room URL Management -->
                    <div class="bg-gray-800 p-4 rounded">
                        <h4 class="text-md font-bold text-blue-400 mb-3">üîó Multiplayer Room</h4>
                        
                        {% if ns.current_match.get('mp_room_url') %}
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-sm text-gray-300">Current Room:</span>
                            <a href="{{ ns.current_match.mp_room_url }}" target="_blank" 
                               class="text-blue-400 hover:text-blue-300 text-sm font-mono">
                                {{ ns.current_match.mp_room_url }}
                            </a>
                        </div>
                        {% else %}
                        <p class="text-gray-400 text-sm mb-3">No multiplayer room set for this match</p>
                        {% endif %}
                        
                        <!-- Set/Update Room URL and optional start -->
                        <form action="{{ url_for('admin.set_match_room') }}" method="POST" class="flex gap-2">
                            <input type="hidden" name="match_id" value="{{ ns.current_match.id }}">
                            <input type="url" name="mp_room_url" 
                                   placeholder="https://osu.ppy.sh/multiplayer/rooms/..." 
                                   value="{{ ns.current_match.get('mp_room_url')|default('', true) }}"
                                   class="flex-1 bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button type="submit" name="action" value="set_and_start" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">
                                ‚ñ∂Ô∏è Set & Start Match
                            </button>
                        </form>
                    </div>
                    
                    <!-- Score Refresh -->
                    {% if ns.current_match.get('mp_room_url') %}
                    <div class="bg-gray-800 p-4 rounded">
                        <h4 class="text-md font-bold text-purple-400 mb-3">üîÑ Score Management</h4>
                        <p class="text-sm text-gray-300 mb-3">
                            Refresh scores from the multiplayer room. Use this after maps are completed.
                        </p>
                        <form action="{{ url_for('admin.refresh_match_scores') }}" method="POST" class="inline">
                            <input type="hidden" name="match_id" value="{{ ns.current_match.id }}">
                            <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded font-bold">
                                üîÑ Refresh Scores from osu!
                            </button>
                        </form>
                    </div>
                    {% endif %}
                    
                    <!-- Tiebreaker Management (3-3 matches) -->
                    {% if ns.current_match.get('score_p1', 0) == 3 and ns.current_match.get('score_p2', 0) == 3 %}
                    <div class="bg-yellow-900 border border-yellow-600 p-4 rounded">
                        <h4 class="text-md font-bold text-yellow-400 mb-3">‚ö° Tiebreaker Match (3-3)</h4>
                        <p class="text-sm text-yellow-200 mb-3">
                            This match is tied 3-3. Set the tiebreaker map that will determine the winner.
                        </p>
                        
                        {% if ns.current_match.get('tiebreaker_map_url') %}
                        <div class="mb-3 p-2 bg-yellow-800 rounded">
                            <p class="text-sm text-yellow-100 mb-2">Current Tiebreaker Map:</p>
                            <a href="{{ ns.current_match.tiebreaker_map_url }}" target="_blank" 
                               class="text-yellow-300 hover:text-yellow-200 font-mono text-sm break-all">
                                {{ ns.current_match.tiebreaker_map_url }}
                            </a>
                        </div>
                        {% endif %}
                        
                        <form action="{{ url_for('admin.set_tiebreaker_map') }}" method="POST" class="flex gap-2">
                            <input type="hidden" name="match_id" value="{{ ns.current_match.id }}">
                            <input type="url" name="tiebreaker_map_url" 
                                   placeholder="https://osu.ppy.sh/beatmapsets/123456#osu/789012" 
                                   value="{{ ns.current_match.get('tiebreaker_map_url', '') }}"
                                   class="flex-1 bg-gray-900 border border-yellow-600 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <button type="submit" class="bg-yellow-600 hover:bg-yellow-700 text-black font-bold px-4 py-2 rounded text-sm">
                                ‚ö° Set Tiebreaker
                            </button>
                        </form>
                        
                        {% if ns.current_match.get('tiebreaker_map_url') %}
                        <form action="{{ url_for('admin.clear_tiebreaker_map') }}" method="POST" class="inline mt-2">
                            <input type="hidden" name="match_id" value="{{ ns.current_match.id }}">
                            <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                                Clear Tiebreaker
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Match Control Actions -->
                    <div class="bg-gray-800 p-4 rounded dev-mode-content">
                        <h4 class="text-md font-bold text-green-400 mb-3">‚ö° Match Controls</h4>
                        <div class="flex flex-wrap gap-2">
                            {% if ns.current_match.get('status') == 'next_up' %}
                            <form action="{{ url_for('admin.start_match') }}" method="POST" class="inline">
                                <input type="hidden" name="match_id" value="{{ ns.current_match.id }}">
                                <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold">
                                    ‚ñ∂Ô∏è Start Match
                                </button>
                            </form>
                            {% endif %}
                            
                            {% if ns.current_match.get('status') == 'in_progress' %}
                            <form action="{{ url_for('admin.reset_match') }}" method="POST" class="inline"
                                  onsubmit="return confirm('Reset this match to Next Up status?');">
                                <input type="hidden" name="match_id" value="{{ ns.current_match.id }}">
                                <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                                    ‚èπÔ∏è Reset to Next Up
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="bg-gray-700 p-6 rounded-lg text-center">
                <p class="text-gray-400 text-lg">üèÅ No current match</p>
                <p class="text-sm text-gray-500 mt-1">All matches may be completed or tournament is between rounds</p>
            </div>
            {% endif %}
        </div>

        <!-- Seeding Management -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8">
            <h2 class="text-2xl text-pink-500 mb-4">Seeding Matches</h2>
            
            <!-- Seeding Room Management -->
            <div class="flex flex-wrap gap-4 items-start mb-6">
                <form action="{{ url_for('admin.start_seeding') }}" method="POST" class="flex gap-2">
                    <input type="url" name="seeding_room_url" placeholder="https://osu.ppy.sh/multiplayer/rooms/..." 
                           class="bg-gray-900 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-500 w-80">
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Start Seeding
                    </button>
                </form>
                
                {% if data.get('seeding_room_url') %}
                <form action="{{ url_for('admin.update_seeding_scores') }}" method="POST" class="inline">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        üîÑ Update Seeding Scores
                    </button>
                </form>
                
                <form action="{{ url_for('admin.finalize_seeding') }}" method="POST" class="inline"
                      onsubmit="return confirm('Finalize seeding and lock placements?');">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        ‚úÖ Finalize Seeding
                    </button>
                </form>
                {% endif %}
            </div>
            
            {% if data.get('seeding_room_url') %}
            <div class="bg-gray-700 p-4 rounded mb-4">
                <p class="text-sm text-gray-300 mb-2">Seeding Room: 
                    <a href="{{ data.seeding_room_url }}" target="_blank" class="text-blue-400 hover:text-blue-300">
                        {{ data.seeding_room_url }}
                    </a>
                </p>
                <p class="text-xs text-gray-400">Players will be automatically seeded based on their cumulative scores across all maps in the room.</p>
            </div>
            {% endif %}
        </div>

        <!-- Developer User Login Section -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8 dev-mode-content">
            <h2 class="text-2xl text-red-400 mb-4">üîß Developer User Login</h2>
            <div class="bg-red-900 border border-red-600 p-4 rounded-lg mb-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-red-300 text-sm font-bold">‚ö†Ô∏è DEVELOPMENT ONLY</span>
                </div>
                <p class="text-red-200 text-sm mb-4">
                    This section allows you to instantly log in as any user for testing purposes. 
                    Use this to test player-specific views and functionality.
                </p>
                
                <!-- Quick Login Buttons for Competitors -->
                {% if data.competitors %}
                <div class="mb-4">
                    <h3 class="text-lg text-red-300 mb-3">üèÉ Quick Login as Competitor:</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                        {% for competitor in data.competitors %}
                        <form action="{{ url_for('admin.dev_login_as_user') }}" method="POST" class="inline">
                            <input type="hidden" name="user_id" value="{{ competitor.id }}">
                            <button type="submit" 
                                    class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-3 rounded text-sm transition-colors">
                                {{ competitor.name }}
                                {% if competitor.get('placement') %}
                                    <span class="text-blue-200">#{{ competitor.placement }}</span>
                                {% endif %}
                            </button>
                        </form>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Manual User ID Login -->
                <div class="border-t border-red-600 pt-4">
                    <h3 class="text-lg text-red-300 mb-3">üéØ Manual User Login:</h3>
                    <form action="{{ url_for('admin.dev_login_as_user') }}" method="POST" class="flex gap-2">
                        <input type="text" name="user_id" 
                               placeholder="Enter osu! User ID or Username" 
                               class="flex-1 bg-gray-900 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                            üöÄ Login as User
                        </button>
                    </form>
                    <p class="text-xs text-red-300 mt-2">
                        üí° Enter either a numeric user ID or username. If user doesn't exist locally, system will attempt to fetch from osu! API.
                    </p>
                </div>
                
                <!-- Current Login Status -->
                <div class="border-t border-red-600 pt-4 mt-4">
                    <h3 class="text-lg text-red-300 mb-2">üë§ Current Session:</h3>
                    {% if session.get('user_id') %}
                    <div class="flex items-center justify-between bg-gray-800 p-3 rounded">
                        <div class="flex items-center gap-2">
                            <span class="text-green-400">‚úÖ Logged in as:</span>
                            <span class="font-bold text-white">
                                {{ session.get('username', 'Unknown User') }} 
                                (ID: {{ session.get('user_id') }})
                            </span>
                        </div>
                        <form action="{{ url_for('admin.dev_logout') }}" method="POST" class="inline">
                            <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white py-1 px-3 rounded text-sm">
                                üö™ Logout
                            </button>
                        </form>
                    </div>
                    {% else %}
                    <div class="bg-gray-800 p-3 rounded">
                        <span class="text-gray-400">‚ùå No user currently logged in</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Navigation Links -->
                <div class="border-t border-red-600 pt-4 mt-4">
                    <h3 class="text-lg text-red-300 mb-2">üîó Quick Navigation:</h3>
                    <div class="flex flex-wrap gap-2">
                        <a href="{{ url_for('public.tournament') }}" target="_blank" 
                           class="bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm">
                            üèÜ Tournament Page
                        </a>
                        {% if session.get('user_id') %}
                        <a href="{{ url_for('player.profile') }}" target="_blank" 
                           class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm">
                           üë§ My Profile
                        </a>
                        {% endif %}
                        <a href="{{ url_for('public.index') }}" target="_blank" 
                           class="bg-purple-600 hover:bg-purple-700 text-white py-1 px-3 rounded text-sm">
                            üè† Home Page
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Competitors Management -->
        <div class="bg-gray-800 p-6 rounded-lg mb-8 dev-mode-content">
            <h2 class="text-2xl text-pink-500 mb-4">Competitors ({{ data.competitors|length }})</h2>
            
            <!-- Add/Reset Competitors & Seeding -->
            <div class="flex flex-wrap gap-4 items-start mb-6">
                <!-- Manual Add Form -->
                <form action="{{ url_for('admin.add_competitor') }}" method="POST" class="flex gap-2">
                    <input type="text" name="username" placeholder="Enter osu! Username" class="bg-gray-900 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-500">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add Competitor</button>
                </form>
                
                <!-- Dangerous Reset Buttons (DEV MODE ONLY) -->
                <div class="dev-mode-content">
                    <div class="flex gap-4 items-center border border-red-500 bg-red-900 p-3 rounded">
                        <span class="text-red-300 text-sm font-bold">DEV DANGER ZONE:</span>
                        <!-- Reset Competitors Button -->
                        <form action="{{ url_for('admin.reset_competitors') }}" method="POST" onsubmit="return confirm('DANGER! This will remove ALL competitors and reset the entire tournament. Are you absolutely sure?');">
                            <button type="submit" class="bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded">Reset All Competitors</button>
                        </form>

                        <!-- Reset All Seed Placements -->
                        <form action="{{ url_for('admin.reset_seeding') }}" method="POST" onsubmit="return confirm('This will clear all seed placements. Continue?');">
                            <button type="submit"
                                    class="bg-yellow-600 hover:bg-yellow-700 text-black font-bold py-2 px-4 rounded">
                              Reset Seeding
                            </button>
                        </form>
                        
                        <!-- Regenerate Bracket (also dangerous) -->
                        <form method="POST" action="{{ url_for('admin.reset_bracket') }}" class="inline">
                            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold"
                                    onclick="return confirm('Are you sure you want to regenerate the bracket? This will reset all match progress.')">
                                üîÑ Regenerate Bracket
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
              {% for c in data.competitors %}
              <div class="bg-gray-700 p-3 rounded flex flex-col items-start gap-2">
                <span class="font-bold">{{ c.name }}</span>
                
                <!-- Show seeding progress if in progress -->
                {% if data.get('seeding_in_progress') %}
                <div class="text-xs text-purple-300">
                  {% if c.get('seeding_score') %}
                    Seeding Score: {{ "{:,}".format(c.seeding_score) }}
                  {% else %}
                    No seeding score yet
                  {% endif %}
                  {% if c.get('provisional_placement') %}
                    <br>Provisional Seed: #{{ c.provisional_placement }}
                  {% endif %}
                </div>
                {% endif %}
                
                <!-- Seed Placement Form (only show if seeding not in progress) -->
                {% if not data.get('seeding_in_progress') %}
                <form action="{{ url_for('admin.set_seed', user_id=c.id) }}" method="POST" class="flex items-center gap-2">
                  <input
                    type="number"
                    name="placement"
                    min="1"
                    placeholder="Seed"
                    value="{{ c.get('placement','') }}"
                    class="bg-gray-900 border border-gray-600 rounded px-2 py-1 w-16 focus:outline-none focus:ring-2 focus:ring-pink-500"
                  />
                  <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded">Set Seed</button>
                </form>
                {% endif %}
                
                <form action="{{ url_for('admin.remove_competitor', user_id=c.id) }}" method="POST" onsubmit="return confirm('Remove {{ c.name }}?');">
                  <button type="submit" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">Remove</button>
                </form>
              </div>
              {% endfor %}
            </div>
        </div>

        <!-- Bracket Management -->
        <div class="bg-gray-800 p-6 rounded-lg dev-mode-content">
            <h2 class="text-2xl text-pink-500 mb-4">Bracket Management</h2>

            <!-- Match Management Macro -->
            {% macro render_match(match, bracket_type) %}
            {% set is_bye_match = match.player1.name == 'BYE' or match.player2.name == 'BYE' %}
            <div class="match-card bg-gray-700 p-4 rounded-lg mb-4 border-l-4 
                        {% if bracket_type == 'upper' %}border-pink-500
                        {% elif bracket_type == 'lower' %}border-blue-500
                        {% else %}border-yellow-500{% endif %}
                        {% if match.get('status') == 'in_progress' %}ring-2 ring-green-400 ring-opacity-50{% endif %}
                        {% if is_bye_match %}opacity-60{% endif %}">
                
                <!-- Match Status Badge -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        {% if is_bye_match %}
                        <span class="inline-block bg-blue-600 text-white px-2 py-1 rounded-full text-xs">
                            ‚ÜóÔ∏è BYE - Auto Advance
                        </span>
                        {% elif match.get('status') == 'completed' %}
                        <span class="inline-block bg-green-600 text-white px-2 py-1 rounded-full text-xs">
                            ‚úì Completed
                        </span>
                        {% elif match.get('status') == 'in_progress' %}
                        <span class="inline-block bg-yellow-500 text-black px-2 py-1 rounded-full text-xs animate-pulse">
                            üî¥ LIVE
                        </span>
                        {% else %}
                        <span class="inline-block bg-gray-600 text-white px-2 py-1 rounded-full text-xs">
                            ‚è≥ Next Up
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="text-xs text-gray-400">
                        {{ bracket_type|title }} Bracket - R{{ match.get('round_index', 0) + 1 }}
                    </div>
                </div>
                
                <!-- Player Names and Current Score -->
                <div class="flex items-center justify-between mb-3">
                    <div class="text-lg {% if match.winner and match.winner.id == match.player1.id %}text-yellow-400 font-bold{% endif %}
                                {% if match.player1.name == 'BYE' %}text-gray-500 italic{% endif %}">
                        {{ match.player1.name }}
                    </div>
                    
                    {% if not is_bye_match %}
                    <div class="flex items-center gap-4">
                        <div class="text-2xl font-mono">
                            <span class="{% if match.winner and match.winner.id == match.player1.id %}text-yellow-400{% endif %}">
                                {{ match.get('score_p1', 0) }}
                            </span>
                            <span class="text-gray-500 mx-2">:</span>
                            <span class="{% if match.winner and match.winner.id == match.player2.id %}text-yellow-400{% endif %}">
                                {{ match.get('score_p2', 0) }}
                            </span>
                        </div>
                    </div>
                    {% else %}
                    <div class="flex items-center gap-4">
                        <span class="text-lg text-gray-400 italic">vs</span>
                    </div>
                    {% endif %}
                    
                    <div class="text-lg text-right {% if match.winner and match.winner.id == match.player2.id %}text-yellow-400 font-bold{% endif %}
                                {% if match.player2.name == 'BYE' %}text-gray-500 italic{% endif %}">
                        {{ match.player2.name }}
                    </div>
                </div>

                <!-- Multiplayer Room Link (only for real matches) -->
                {% if not is_bye_match and match.get('mp_room_url') %}
                <div class="mb-3">
                    <a href="{{ match.mp_room_url }}" target="_blank" 
                       class="inline-flex items-center text-blue-400 hover:text-blue-300 text-sm">
                        üéÆ Multiplayer Room
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                    </a>
                </div>
                {% endif %}

                <!-- Match Control Buttons (only for real matches) -->
                {% if not is_bye_match %}
                <div class="flex items-center justify-between mb-3 gap-2">
                    {% if match.get('status') == 'next_up' %}
                    <form action="{{ url_for('admin.start_match') }}" method="POST" class="inline">
                        <input type="hidden" name="match_id" value="{{ match.id }}">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm">
                            ‚ñ∂Ô∏è Start Match
                        </button>
                    </form>
                    {% elif match.get('status') == 'in_progress' %}
                    <div class="flex gap-2 items-center">
                        <span class="bg-yellow-500 text-black py-1 px-3 rounded text-sm font-bold">
                            üî¥ Match In Progress
                        </span>
                        <!-- Auto-refresh match results button -->
                        {% if match.get('mp_room_url') %}
                        <form action="{{ url_for('admin.refresh_match_scores') }}" method="POST" class="inline">
                            <input type="hidden" name="match_id" value="{{ match.id }}">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm">
                                üîÑ Refresh Scores
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    {% else %}
                    <span class="bg-green-600 text-white py-1 px-3 rounded text-sm">
                        ‚úÖ Match Complete
                    </span>
                    {% endif %}
                    
                    <!-- Reset Match Button (DEV MODE ONLY) -->
                    {% if match.get('status') != 'next_up' %}
                    <div class="dev-mode-content">
                        <form action="{{ url_for('admin.reset_match') }}" method="POST" class="inline" 
                              onsubmit="return confirm('Reset this match to Next Up status?');">
                            <input type="hidden" name="match_id" value="{{ match.id }}">
                            <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white py-1 px-3 rounded text-sm">
                                üîÑ Reset
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>

                <!-- Quick Win Buttons (DEV MODE ONLY) -->
                {% if match.get('status') != 'completed' %}
                <div class="dev-mode-content mb-3">
                    <div class="flex items-center justify-between border border-orange-500 bg-orange-900 p-2 rounded">
                        <form action="{{ url_for('admin.set_winner') }}" method="POST" class="inline">
                            <input type="hidden" name="match_id" value="{{ match.id }}">
                            <input type="hidden" name="winner_id" value="{{ match.player1.id }}">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm">
                                4-0 Win
                            </button>
                        </form>
                        <span class="text-orange-300 text-sm font-bold">DEV: Quick Actions</span>
                        <form action="{{ url_for('admin.set_winner') }}" method="POST" class="inline">
                            <input type="hidden" name="match_id" value="{{ match.id }}">
                            <input type="hidden" name="winner_id" value="{{ match.player2.id }}">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm">
                                4-0 Win
                            </button>
                        </form>
                    </div>
                </div>
                {% endif %}

                <!-- Detailed Score Management (DEV MODE ONLY) -->
                {% if match.get('status') != 'completed' %}
                <div class="dev-mode-content">
                    <div class="border border-orange-500 bg-orange-900 p-3 rounded">
                        <div class="mb-2 text-center">
                            <span class="text-orange-300 text-sm font-bold">DEV: Manual Score Control</span>
                        </div>
                        <form action="{{ url_for('admin.set_score') }}" method="POST">
                            <input type="hidden" name="match_id" value="{{ match.id }}">
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- Score Inputs -->
                                <div class="flex items-center justify-center gap-4">
                                    <div class="text-center">
                                        <label class="block text-xs text-gray-400 mb-1">{{ match.player1.name[:10] }}</label>
                                        <input type="number" name="score_p1" min="0" max="4" 
                                               value="{{ match.get('score_p1', 0) }}"
                                               class="score-input bg-gray-900 border border-gray-600 rounded px-2 py-1 text-center focus:outline-none focus:ring-2 focus:ring-pink-500">
                                    </div>
                                    <span class="text-gray-500 mt-4">:</span>
                                    <div class="text-center">
                                        <label class="block text-xs text-gray-400 mb-1">{{ match.player2.name[:10] }}</label>
                                        <input type="number" name="score_p2" min="0" max="4" 
                                               value="{{ match.get('score_p2', 0) }}"
                                               class="score-input bg-gray-900 border border-gray-600 rounded px-2 py-1 text-center focus:outline-none focus:ring-2 focus:ring-pink-500">
                                    </div>
                                </div>

                                <!-- MP Room URL -->
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Multiplayer Room URL</label>
                                    <input type="url" name="mp_room_url" 
                                           value="{{ match.get('mp_room_url', '') }}"
                                           placeholder="https://osu.ppy.sh/multiplayer/rooms/..."
                                           class="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>

                                <!-- Submit Button -->
                                <div class="flex items-end">
                                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                                        Update Score
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                {% endif %}
                {% else %}
                <!-- BYE match explanation -->
                <div class="text-center py-2">
                    <span class="text-sm text-gray-400 italic">
                        {% if match.player1.name == 'BYE' %}
                            {{ match.player2.name }} advances automatically
                        {% else %}
                            {{ match.player1.name }} advances automatically
                        {% endif %}
                    </span>
                </div>
                {% endif %}
            </div>
            {% endmacro %}

            <!-- Upper Bracket Rounds -->
            <div class="mb-8">
                <h3 class="text-xl text-pink-400 mb-4">Upper Bracket</h3>
                {% for round_matches in data.brackets.upper %}
                <div class="mb-6">
                    <h4 class="text-lg mb-4 border-b border-pink-500 pb-2">Round {{ loop.index }}</h4>
                    {% for match in round_matches %}
                        {{ render_match(match, 'upper') }}
                    {% endfor %}
                </div>
                {% endfor %}
            </div>

            <!-- Lower Bracket Rounds -->
            <div class="mb-8">
                <h3 class="text-xl text-blue-400 mb-4">Lower Bracket</h3>
                {% for round_matches in data.brackets.lower %}
                <div class="mb-6">
                    <h4 class="text-lg mb-4 border-b border-blue-500 pb-2">Round {{ loop.index }}</h4>
                    {% for match in round_matches %}
                        {{ render_match(match, 'lower') }}
                    {% endfor %}
                </div>
                {% endfor %}
            </div>

            <!-- Grand Finals Management -->
            {% if data.brackets.grand_finals %}
            <div class="mt-8">
                <h3 class="text-xl text-yellow-300 mb-4">Grand Finals</h3>
                
                <!-- Show previous match if bracket was reset -->
                {% if data.brackets.grand_finals.get('is_bracket_reset') and data.brackets.grand_finals.get('previous_gf') %}
                <div class="mb-6">
                    <h4 class="text-lg mb-4 border-b border-gray-500 pb-2">Match 1 (Completed - Bracket Reset)</h4>
                    <div class="opacity-75">
                        {{ render_match(data.brackets.grand_finals.previous_gf, 'grand_finals') }}
                    </div>
                </div>
                {% endif %}
                
                <!-- Current grand finals match -->
                <div class="mb-6">
                    {% if data.brackets.grand_finals.get('is_bracket_reset') %}
                    <h4 class="text-lg mb-4 border-b border-yellow-500 pb-2">Match 2 (Championship)</h4>
                    {% endif %}
                    {{ render_match(data.brackets.grand_finals, 'grand_finals') }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Admin-only keyboard shortcuts for overlay control
        document.addEventListener('keydown', function(e) {
            // Only work when not typing in input fields
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            if (e.ctrlKey && e.shiftKey) {
                e.preventDefault(); // Prevent browser shortcuts
                
                switch(e.key) {
                    case 'A': // Ctrl+Shift+A - Toggle AFK
                        fetch('{{ url_for("admin.overlay_toggle_afk") }}', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            }
                        }).then(() => {
                            showNotification('AFK screen toggled', 'info');
                        });
                        break;
                        
                    case 'H': // Ctrl+Shift+H - Hide victory screens
                        fetch('{{ url_for("admin.overlay_hide_victory") }}', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            }
                        }).then(() => {
                            showNotification('Victory screens hidden', 'info');
                        });
                        break;
                        
                    case 'R': // Ctrl+Shift+R - Refresh overlay data
                        fetch('{{ url_for("admin.overlay_refresh_data") }}', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            }
                        }).then(() => {
                            showNotification('Overlay data refreshed', 'success');
                        });
                        break;
                        
                    case 'V': // Ctrl+Shift+V - Show match victory
                        fetch('{{ url_for("admin.overlay_show_match_victory") }}', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            }
                        }).then(() => {
                            showNotification('Match victory screen shown', 'success');
                        });
                        break;
                        
                    case 'O': // Ctrl+Shift+O - Open overlay in new tab
                        window.open('{{ url_for("public.tournament_overlay") }}', '_blank');
                        showNotification('Overlay opened in new tab', 'info');
                        break;
                }
            }
        });
        
        // Show notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded shadow-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            } text-white`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Dev mode toggle functionality
        function toggleDevMode() {
            const body = document.body;
            const button = document.getElementById('devModeToggle');
            
            if (body.classList.contains('dev-mode-enabled')) {
                body.classList.remove('dev-mode-enabled');
                button.textContent = 'Enable Dev Mode';
                button.className = 'bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded font-bold';
                localStorage.setItem('devModeEnabled', 'false');
            } else {
                body.classList.add('dev-mode-enabled');
                button.textContent = 'Disable Dev Mode';
                button.className = 'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold';
                localStorage.setItem('devModeEnabled', 'true');
            }
        }

        // Outro form control functions
        function showOutroForm() {
            document.getElementById('outroForm').classList.remove('hidden');
        }

        function hideOutroForm() {
            document.getElementById('outroForm').classList.add('hidden');
        }
        
        // Show keyboard shortcuts help
        document.addEventListener('DOMContentLoaded', function() {
            // Restore dev mode state from localStorage
            const devModeEnabled = localStorage.getItem('devModeEnabled') === 'true';
            if (devModeEnabled) {
                document.body.classList.add('dev-mode-enabled');
                document.getElementById('devModeToggle').textContent = 'Disable Dev Mode';
                document.getElementById('devModeToggle').className = 'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold';
            }
            
            // Add help tooltip or modal trigger if needed
            console.log('Admin overlay shortcuts:');
            console.log('Ctrl+Shift+A - Toggle AFK screen');
            console.log('Ctrl+Shift+H - Hide victory screens');
            console.log('Ctrl+Shift+R - Refresh overlay data');
            console.log('Ctrl+Shift+O - Open overlay');
        });
        
        // preserve/restore scroll position across full reloads
        document.addEventListener('DOMContentLoaded', function() {
            const y = sessionStorage.getItem('scrollPos');
            if (y) window.scrollTo(0, +y);
        });
        window.addEventListener('beforeunload', function() {
            sessionStorage.setItem('scrollPos', window.scrollY);
        });
    </script>
</body>
</html>